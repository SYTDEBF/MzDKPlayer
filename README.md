
# MzDKPlayer - 安卓TV本地弹幕视频播放器

> 一款专为安卓电视（Android TV）设计的本地视频播放器，支持弹幕功能、多种网络协议播放及高端音频视频格式解码。

---

## 目录
- [功能特性](#功能特性)
  - [核心功能](#核心功能)
  - [高级解码支持](#高级解码支持)
  - [用户界面](#用户界面)
- [已知问题](#已知问题) 
- [应用演示](#应用演示)
- [技术架构](#技术架构)
  - [主要技术栈](#主要技术栈)
  - [核心组件](#核心组件)
- [硬件要求](#硬件要求)
  - [推荐配置](#推荐配置)
  - [最低要求](#最低要求)
- [安装与使用](#安装与使用)
  - [构建要求](#构建要求)
  - [安装步骤](#安装步骤)
  - [基本使用](#基本使用)
- [项目状态](#项目状态)
  - [近期开发计划](#近期开发计划)
- [贡献](#贡献)
- [许可证](#许可证)
- [免责声明](#免责声明)

---

## 功能特性

### 核心功能
- 🎬 **本地视频播放** - 支持多种视频格式的本地播放
- 🎵 **本地音频，图片播放** - 支持多种音频，图片格式的本地播放
- 💬 **弹幕功能** - 支持B站风格弹幕显示与自定义
- 🌐 **网络协议支持**：
  - ✅ SMB协议（当前已支持）
  - ✅ FTP协议（当前已支持）
  - ✅ WebDAV协议（当前已支持）
  - ✅ NFS协议（当前已支持）
- 🎚️ **多轨道选择** - 支持音轨、视频轨、字幕轨切换

### 高级解码支持
- **视频编码**：
  - 杜比视界（Dolby Vision）硬解
  - HDR视频播放
- **音频编码**：
  - 杜比全景声（Dolby Atmos）
  - Dolby TrueHD 透传（需要设备支持）
  - DTS-HD 透传（需要设备支持）
- **字幕格式**：
  - ASS/SSA字幕格式支持
  - SRT等常见字幕格式

### 用户界面
- 专为电视大屏优化的UI设计
- 基于Jetpack Compose构建的现代化界面
- 遥控器友好操作体验

---

## 已知问题

⚠️ **重要提示：SMB播放卡顿问题（尤其在低性能设备上）**

虽然日志显示 SMB 数据预加载阶段速度稳定（如：9.7~9.9 MB/s），**但一旦视频正式开始播放，读取速度会明显下降，导致播放卡顿或缓冲频繁**。

### 📊 问题表现：
- 播放前预加载日志示例：
  ```
  2025-09-19 21:59:13.913 ... I 预加载 2MB 耗时 201ms, 速度: 9.95 MB/s
  2025-09-19 21:59:14.865 ... I 预加载 2MB 耗时 205ms, 速度: 9.76 MB/s
  ```
  → 此阶段无视频解码压力，SMB 读取流畅。

- **播放开始后**：视频解码线程启动，CPU/GPU 资源被大量占用 → 导致 SMB 读取线程被抢占或调度延迟 → 读取速度骤降 → 缓冲区不足 → 卡顿！

### 🎯 根本原因：
1. **单线程/低优先级 I/O 设计**：当前 SMB 数据源未与视频解码线程充分解耦，缺乏异步预缓冲或独立高优先级下载线程。
2. **设备性能瓶颈**：在 2GB RAM 或低端芯片（如 MT9653）设备上，同时进行高码率视频解码 + 网络读取 + 弹幕渲染，极易资源争抢。
3. **ExoPlayer 缓冲策略未针对 SMB 优化**：默认缓冲区较小，网络波动或瞬时卡顿即触发卡顿。

### ✅ 临时解决方案：
- 选择40G以下的视频源
- 将视频**复制到本地存储播放**，可完全规避此问题。
- 使用**有线网络**（千兆）代替 Wi-Fi，提升底层传输稳定性。
- 在播放器设置中**手动增大缓冲区大小**（若支持）。
- 降低视频码率或转码为更易解码格式（如 H.264 + AAC）。

> 💡 开发者备注：   
> 此问题将在后续版本中尝试通过“独立下载线程 + 动态缓冲区 + 优先级调度”优化(大佬来写)，但**设备性能不足仍是硬伤**。

---

## 应用演示

### 主界面
[主界面截图](screenshots/Screenshot_20250918_142308.png)  
[主界面截图](screenshots/Screenshot_20250918_142046.png)

### 播放界面与弹幕效果
[播放界面截图](screenshots/Screenshot_20250918_142126.png)  
[播放界面截图](screenshots/Screenshot_20250918_142237.png)

---

## 技术架构

### 主要技术栈
- **媒体播放**：ExoPlayer + 自定义扩展
- **界面框架**：Jetpack Compose for TV
- **弹幕引擎**：AKDanmaku
- **字幕渲染**：ASS字幕渲染库
- **网络协议**：自定义SMB/FTP/WebDAV客户端实现

### 核心组件
- `VideoPlayerScreen` - 主播放器界面
- `BuilderMzPlayer` - 播放器构建与配置
- `AkDanmakuPlayer` - 弹幕播放组件
- 多轨道选择面板（音轨、视频轨、字幕轨）

---

## 硬件要求

### 推荐配置
- **芯片组**：Amlogic S928X-J
- **内存**：4GB RAM及以上
- **系统**：Android TV 11及以上

### 最低要求
- **芯片组**：MT9653或同等性能芯片
- **内存**：2GB RAM
- **系统**：Android TV 5及以上

> ⚠️ **注意**：代码写的烂，不会优化，能跑就成功，都是bug，设备性能不足可能导致视频与弹幕播放卡顿，或无法正常播放高码率视频

---

## 安装与使用

### 构建要求
- Android Studio 2022.3+
- Android SDK 33+
- Kotlin 1.8+

### 安装步骤
1. 克隆项目到本地
2. 使用Android Studio打开项目
3. 连接支持ADB调试的安卓TV设备
4. 构建并运行应用

### 基本使用
1. 主界面选择视频文件（本地或网络）播放器会自动选择同目录下相同文件名的xml弹幕文件
2. 播放界面使用遥控器控制：
  - 左右键：快进/快退
  - 确认键：暂停/播放
  - 菜单键：显示设置选项
1. 弹幕功能可开关调整

---

## 项目状态

⚠️ **开发阶段**：初始阶段，存在已知Bug

### 近期开发计划
- [ x ] FTP协议支持
- [ x ] WebDAV协议支持
- [ x ] NFS协议支持
- [ x ] 音频文件，图片文件支持
- [ ] 播放列表管理
- [ ] 网络弹幕加载功能
- [ ] 设置界面优化
- [ ] **SMB 播放性能优化（多线程缓冲 + 优先级调度）** ← 新增计划项

---

## 贡献

欢迎提交 Issue 和 Pull Request 来帮助改进这个项目。尤其欢迎对 **SMB 性能优化** 和 **播放器稳定性** 的贡献！

---



---

## 免责声明

本软件仅供学习交流使用，请勿用于商业用途。使用本软件造成的任何问题，开发者不承担相关责任。

---

**注意**：杜比视界、杜比全景声、DTS-HD等功能的正常使用需要设备硬件支持，部分功能可能需要特定的音频视频设备才能获得最佳体验。

---


